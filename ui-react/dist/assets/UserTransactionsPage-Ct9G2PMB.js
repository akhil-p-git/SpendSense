import{j as e,u,h as v,r as d,C as l,L as w,E as C,c as k,R as S,N as T}from"./index-DWPGfbpl.js";import{f as p}from"./format-i9BddnD9.js";import{R as L,P as M,a as F,C as E,T as B,L as R}from"./PieChart-DxFTvg-k.js";const D=t=>{const s={"Food & Dining":"bg-blue-100 text-blue-800",Shopping:"bg-purple-100 text-purple-800","Bills & Utilities":"bg-orange-100 text-orange-800",Transportation:"bg-green-100 text-green-800",Entertainment:"bg-pink-100 text-pink-800",Income:"bg-success-100 text-success-800",Transfer:"bg-gray-100 text-gray-800",Other:"bg-gray-100 text-gray-800"};return s[t]||s.Other},I=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),P=({transaction:t})=>{const r=t.amount>0?"text-success-600":"text-gray-900";return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:I(t.date)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:t.merchant_name||"Unknown"}),e.jsx("td",{className:`px-4 py-3 text-sm font-semibold ${r}`,children:p(Math.abs(t.amount))}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${D(t.category_primary||"Other")}`,children:t.category_primary||"Other"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.payment_channel||"N/A"})]})},A=()=>{const{currentUserId:t}=u(),{data:s,isLoading:r,error:a}=v(t),[c,y]=d.useState("date"),[n,i]=d.useState("desc"),x=d.useMemo(()=>s!=null&&s.transactions?s.transactions.slice(0,30):[],[s]),g=d.useMemo(()=>[...x].sort((N,b)=>{let m=0;return c==="date"?m=new Date(N.date).getTime()-new Date(b.date).getTime():c==="amount"&&(m=Math.abs(N.amount)-Math.abs(b.amount)),n==="asc"?m:-m}),[x,c,n]),j=o=>{c===o?i(n==="asc"?"desc":"asc"):(y(o),i("desc"))},f=({field:o})=>c!==o?e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):n==="asc"?e.jsx("svg",{className:"w-4 h-4 text-primary-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}):e.jsx("svg",{className:"w-4 h-4 text-primary-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})});return t?r?e.jsx(l,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(w,{size:"lg"})})}):a?e.jsx(l,{children:e.jsx(C,{message:a instanceof Error?a.message:"Failed to load transactions"})}):g.length===0?e.jsx(l,{children:e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No transactions found"})}):e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Transactions"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Showing ",g.length," transactions"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>j("date"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Date",e.jsx(f,{field:"date"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Merchant"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>j("amount"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Amount",e.jsx(f,{field:"amount"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Channel"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(o=>e.jsx(P,{transaction:o},o.transaction_id))})]})})]}):e.jsx(l,{children:e.jsx("p",{className:"text-gray-500",children:"Please select a user to view transactions."})})},h=["#3B82F6","#8B5CF6","#F59E0B","#10B981","#EC4899","#EF4444","#6366F1","#14B8A6"],O=({active:t,payload:s})=>{if(t&&s&&s.length){const r=s[0].payload;return e.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Amount: ",e.jsx("span",{className:"font-semibold",children:p(r.value)})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Percentage: ",e.jsxs("span",{className:"font-semibold",children:[r.percentage.toFixed(1),"%"]})]})]})}return null},U=({transactions:t})=>{const s=d.useMemo(()=>{const r=t.filter(n=>n.amount<0),a=new Map;r.forEach(n=>{const i=n.category_primary||"Other",x=Math.abs(n.amount);a.set(i,(a.get(i)||0)+x)});const c=Array.from(a.values()).reduce((n,i)=>n+i,0);return Array.from(a.entries()).map(([n,i])=>({name:n,value:i,percentage:c>0?i/c*100:0})).sort((n,i)=>i.value-n.value).slice(0,8)},[t]);return s.length===0?e.jsxs(l,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Spending by Category"}),e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No spending data available"})]}):e.jsxs(l,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Spending by Category"}),e.jsx("div",{className:"w-full",style:{height:"400px"},children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(M,{children:[e.jsx(F,{data:s,cx:"50%",cy:"50%",labelLine:!1,label:r=>{const a=r.percentage||0;return`${r.name} (${a.toFixed(0)}%)`},outerRadius:120,fill:"#8884d8",dataKey:"value",children:s.map((r,a)=>e.jsx(E,{fill:h[a%h.length]},`cell-${a}`))}),e.jsx(B,{content:e.jsx(O,{})}),e.jsx(R,{verticalAlign:"bottom",height:36,formatter:r=>e.jsx("span",{className:"text-sm text-gray-700",children:r})})]})})}),e.jsx("div",{className:"mt-6 space-y-2",children:s.map((r,a)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:h[a%h.length]}}),e.jsx("span",{className:"text-sm text-gray-700",children:r.name})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[r.percentage.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm font-semibold text-gray-900 w-24 text-right",children:p(r.value)})]})]},r.name))})]})},_=()=>{const{currentUserId:t}=u(),{data:s}=v(t),r=(s==null?void 0:s.transactions)||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Transactions"}),e.jsx(U,{transactions:r}),e.jsx(A,{})]})},z=()=>{const{userId:t}=k(),{setCurrentUserId:s}=u();return S.useEffect(()=>{t&&s(t)},[t,s]),t?e.jsx(_,{}):e.jsx(T,{to:"/",replace:!0})};export{z as UserTransactionsPage};
//# sourceMappingURL=UserTransactionsPage-Ct9G2PMB.js.map

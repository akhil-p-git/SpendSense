import{i as w,j as e,C as c,L as m,E as g,k as C,l as S,m as _,B as f,n as k,o as F,r as P,u as E,R as L}from"./index-DWPGfbpl.js";import{a as h}from"./format-i9BddnD9.js";import{R,P as O,a as U,C as A,T as B,L as T}from"./PieChart-DxFTvg-k.js";const N=s=>h(s*100),v={"High Utilization":"#EF4444","Variable Income Budgeter":"#F59E0B","Subscription-Heavy":"#8B5CF6","Emergency Fund Starter":"#F97316","Savings Builder":"#10B981","Debt Optimizer":"#3B82F6"},$=({active:s,payload:n})=>{if(s&&n&&n.length){const t=n[0].payload;return e.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Count: ",e.jsx("span",{className:"font-semibold",children:t.count})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Percentage: ",e.jsx("span",{className:"font-semibold",children:N(t.percentage)})]})]})}return null},z=()=>{const{data:s,isLoading:n,error:t}=w();if(n)return e.jsx(c,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(m,{size:"lg"})})});if(t)return e.jsx(c,{children:e.jsx(g,{message:t instanceof Error?t.message:"Failed to load persona distribution"})});if(!s||!s.distribution||Object.keys(s.distribution).length===0)return e.jsxs(c,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Persona Distribution"}),e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No persona data available"})]});const i=Object.entries(s.distribution).map(([r,d])=>({name:r,count:d.count,percentage:d.percentage,value:d.count}));return e.jsxs(c,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Persona Distribution"}),e.jsx("div",{className:"w-full",style:{height:"300px"},children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(O,{children:[e.jsx(U,{data:i,cx:"50%",cy:"50%",labelLine:!1,label:r=>{const d=r.percentage||0;return`${r.name} (${d.toFixed(0)}%)`},outerRadius:100,fill:"#8884d8",dataKey:"value",children:i.map(r=>e.jsx(A,{fill:v[r.name]||"#9CA3AF"},`cell-${r.name}`))}),e.jsx(B,{content:e.jsx($,{})}),e.jsx(T,{verticalAlign:"bottom",height:36,formatter:r=>e.jsx("span",{className:"text-sm text-gray-700",children:r})})]})})}),e.jsx("div",{className:"mt-6 space-y-2",children:i.map(r=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:v[r.name]||"#9CA3AF"}}),e.jsx("span",{className:"text-sm text-gray-700",children:r.name})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[r.count," users"]}),e.jsx("span",{className:"text-sm font-semibold text-gray-900 w-16 text-right",children:N(r.percentage)})]})]},r.name))})]})},p=({label:s,value:n,max:t,color:i="bg-primary-600"})=>{const r=t>0?n/t*100:0;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-700",children:s}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[n," / ",t," (",h(r),")"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:`h-2.5 rounded-full ${i}`,style:{width:`${Math.min(r,100)}%`}})})]})},D=()=>{const{data:s,isLoading:n,error:t}=C();if(n)return e.jsx(c,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(m,{size:"lg"})})});if(t)return e.jsx(c,{children:e.jsx(g,{message:t instanceof Error?t.message:"Failed to load recommendation tracking"})});if(!s)return e.jsxs(c,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recommendation Tracking"}),e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No tracking data available"})]});const i=s.acceptance_rate||0,r=s.total_views||0,d=s.total_acceptances||0;return e.jsxs(c,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recommendation Tracking"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Overall Acceptance Rate"}),e.jsx("span",{className:"text-2xl font-bold text-primary-600",children:h(i*100)})]}),e.jsx(p,{label:"Accepted",value:d,max:r||1,color:"bg-success-600"})]}),s.by_type&&Object.keys(s.by_type).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"By Recommendation Type"}),e.jsx("div",{className:"space-y-3",children:Object.entries(s.by_type).map(([l,a])=>e.jsx(p,{label:l||"Unknown",value:a.acceptances||0,max:a.views||1,color:"bg-blue-600"},l))})]}),s.by_persona&&Object.keys(s.by_persona).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"By Persona"}),e.jsx("div",{className:"space-y-3",children:Object.entries(s.by_persona).map(([l,a])=>e.jsx(p,{label:l||"Unknown",value:a.acceptances||0,max:a.views||1,color:"bg-purple-600"},l))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Total Shown"}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:r})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Total Accepted"}),e.jsx("div",{className:"text-lg font-semibold text-success-600",children:d})]})]})]})]})},x=({label:s,value:n,target:t,meetsTarget:i,suffix:r=""})=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s}),i!==void 0&&e.jsx("span",{className:i?"text-success-600":"text-danger-600",children:i?e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[n,r]}),t&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(target: ",t,")"]})]})]}),H=s=>{const n=Math.floor(s/86400),t=Math.floor(s%86400/3600),i=Math.floor(s%3600/60);return n>0?`${n}d ${t}h`:t>0?`${t}h ${i}m`:`${i}m`},M=()=>{var a,o,u,j,y,b;const{data:s,isLoading:n,error:t}=S();if(n)return e.jsx(c,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(m,{size:"lg"})})});if(t)return e.jsx(c,{children:e.jsx(g,{message:t instanceof Error?t.message:"Failed to load system health"})});if(!s)return e.jsxs(c,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Health"}),e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No health data available"})]});const i=((a=s.latency)==null?void 0:a.avg_seconds)||0,l=i*1e3<5e3;return e.jsxs(c,{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"System Health"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(x,{label:"Uptime",value:H(s.uptime_seconds||0),meetsTarget:!0}),e.jsx(x,{label:"Average Latency",value:`${i.toFixed(2)}s`,target:"< 5s",meetsTarget:l}),e.jsx(x,{label:"Total API Calls",value:((o=s.api_calls)==null?void 0:o.total)||0,suffix:""}),e.jsx(x,{label:"User Consent Rate",value:h((((u=s.users)==null?void 0:u.consent_rate_percent)||0)/100*100),meetsTarget:(((j=s.users)==null?void 0:j.consent_rate_percent)||0)>=80})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"System Status"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${l&&(((y=s.users)==null?void 0:y.consent_rate_percent)||0)>=80?"bg-success-100 text-success-800":"bg-warning-100 text-warning-800"}`,children:l&&(((b=s.users)==null?void 0:b.consent_rate_percent)||0)>=80?"Healthy":"Needs Attention"})]})})]})},I=({filters:s,onFiltersChange:n})=>{const t=_(),i=(l,a)=>{n({...s,[l]:a===""?void 0:a})},r=()=>{n({})},d=async()=>{try{const l=await t.mutateAsync(),a=window.URL.createObjectURL(l),o=document.createElement("a");o.href=a,o.download=`evaluation_report_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(a),document.body.removeChild(o)}catch(l){console.error("Export failed:",l),alert(`Failed to export PDF: ${l instanceof Error?l.message:"Unknown error"}`)}};return e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{htmlFor:"persona-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Persona"}),e.jsxs("select",{id:"persona-filter",value:s.persona||"",onChange:l=>i("persona",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Personas"}),e.jsx("option",{value:"High Utilization",children:"High Utilization"}),e.jsx("option",{value:"Variable Income Budgeter",children:"Variable Income Budgeter"}),e.jsx("option",{value:"Subscription-Heavy",children:"Subscription-Heavy"}),e.jsx("option",{value:"Emergency Fund Starter",children:"Emergency Fund Starter"}),e.jsx("option",{value:"Savings Builder",children:"Savings Builder"}),e.jsx("option",{value:"Debt Optimizer",children:"Debt Optimizer"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{htmlFor:"signal-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Signal Type"}),e.jsxs("select",{id:"signal-filter",value:s.signal_type||"",onChange:l=>i("signal_type",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Signals"}),e.jsx("option",{value:"subscriptions",children:"Subscriptions"}),e.jsx("option",{value:"savings",children:"Savings"}),e.jsx("option",{value:"credit",children:"Credit"}),e.jsx("option",{value:"income",children:"Income"})]})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{htmlFor:"consent-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Consent Status"}),e.jsxs("select",{id:"consent-filter",value:s.has_consent||"",onChange:l=>i("has_consent",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Users"}),e.jsx("option",{value:"true",children:"Consented"}),e.jsx("option",{value:"false",children:"Not Consented"})]})]}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(f,{variant:"secondary",onClick:r,className:"whitespace-nowrap",children:"Clear Filters"}),e.jsx(f,{variant:"primary",onClick:d,disabled:t.isPending,className:"whitespace-nowrap",children:t.isPending?"Exporting...":"Export PDF Report"})]})]})})},V=s=>({"High Utilization":"bg-red-100 text-red-800","Variable Income Budgeter":"bg-yellow-100 text-yellow-800","Subscription-Heavy":"bg-purple-100 text-purple-800","Emergency Fund Starter":"bg-orange-100 text-orange-800","Savings Builder":"bg-green-100 text-green-800","Debt Optimizer":"bg-blue-100 text-blue-800"})[s]||"bg-gray-100 text-gray-800",K=({filters:s})=>{const n=k(),{data:t,isLoading:i,error:r}=F(s),d=a=>{n(`/users/${a}/recommendations`)};if(i)return e.jsx(c,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(m,{size:"lg"})})});if(r)return e.jsx(c,{children:e.jsx(g,{message:r instanceof Error?r.message:"Failed to load users"})});if(!t||!t.users||t.users.length===0)return e.jsx(c,{children:e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No users found matching filters"})});const l=a=>{const o=[];return a.has_subscription_signal&&o.push("Subscriptions"),a.has_savings_signal&&o.push("Savings"),a.has_credit_signal&&o.push("Credit"),a.has_income_signal&&o.push("Income"),o.length>0?o.join(", "):"None"};return e.jsxs(c,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Users"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.users.length," users"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Persona"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Consent Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Signals Summary"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.users.map(a=>e.jsxs("tr",{onClick:()=>d(a.user_id),className:"cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap",children:a.name||"Unknown"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600 whitespace-nowrap",children:a.email||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${V(a.persona||"Unknown")}`,children:a.persona||"Unknown"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a.consent?"bg-success-100 text-success-800":"bg-gray-100 text-gray-800"}`,children:a.consent?"Consented":"Not Consented"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:l(a)})]},a.user_id))})]})})]})},q=()=>{const[s,n]=P.useState({});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Operator Dashboard"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(z,{}),e.jsx(D,{}),e.jsx(M,{})]}),e.jsx(I,{filters:s,onFiltersChange:n}),e.jsx(K,{filters:s})]})},W=()=>{const{setActiveTab:s}=E();return L.useEffect(()=>{s("operator")},[s]),e.jsx(q,{})};export{W as OperatorPage};
//# sourceMappingURL=OperatorPage-BM-TLb1D.js.map
